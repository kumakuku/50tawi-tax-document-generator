<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ (‡∏†.‡∏á.‡∏î. 1‡∏Å)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.95;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 35px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: '';
            width: 6px;
            height: 24px;
            background: #667eea;
            border-radius: 3px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            font-family: 'Sarabun', sans-serif;
            transition: all 0.3s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .signature-pad {
            border: 2px dashed #667eea;
            border-radius: 10px;
            background: white;
            cursor: crosshair;
            touch-action: none;
        }
        
        .signature-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Sarabun', sans-serif;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
            font-size: 18px;
            padding: 15px 40px;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        
        .csv-upload {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .csv-upload:hover {
            background: #e9ecef;
            border-color: #5568d3;
        }
        
        .csv-upload input[type="file"] {
            display: none;
        }
        
        .preview-table {
            margin-top: 20px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .progress-container {
            display: none;
            margin-top: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }
        
        @media print {
            body {
                background: white;
            }
            .no-print {
                display: none;
            }
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .info-box p {
            margin: 5px 0;
            color: #1565c0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßæ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢</h1>
            <p>‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏≤ 50 ‡∏ó‡∏ß‡∏¥ ‡πÅ‡∏´‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏£‡∏±‡∏©‡∏é‡∏≤‡∏Å‡∏£ (‡∏†.‡∏á.‡∏î. 1‡∏Å)</p>
        </div>
        
        <div class="content">
            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó -->
            <div class="section">
                <div class="section-title">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó)</div>
                <div class="info-box">
                    <p><strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</p>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó *</label>
                        <input type="text" id="company_name" placeholder="‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC ‡∏à‡∏≥‡∏Å‡∏±‡∏î">
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ (13 ‡∏´‡∏•‡∏±‡∏Å) *</label>
                        <input type="text" id="company_tax_id" placeholder="0123456789012" maxlength="13">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó *</label>
                        <textarea id="company_address" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏ñ‡∏ô‡∏ô ‡∏ï‡∏≥‡∏ö‡∏• ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå"></textarea>
                    </div>
                </div>
            </div>
            
            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏° -->
            <div class="section">
                <div class="section-title">‚úçÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏°</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏° *</label>
                        <input type="text" id="signer_name" placeholder="‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
                    </div>
                    <div class="form-group">
                        <label>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</label>
                        <input type="text" id="signer_position" placeholder="‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£">
                    </div>
                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á *</label>
                        <input type="date" id="issue_date">
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• (‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)</label>
                    <canvas id="signature_pad" class="signature-pad" width="600" height="200"></canvas>
                    <div class="signature-controls">
                        <button class="btn btn-secondary" onclick="clearSignature()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                        <button class="btn btn-secondary" onclick="saveSignature()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                    </div>
                </div>
            </div>
            
            <!-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° -->
            <div class="section">
                <div class="section-title">üìù ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</div>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="form_type_1" value="1‡∏Å" checked>
                        <label for="form_type_1">‡∏†.‡∏á.‡∏î. 1‡∏Å</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="form_type_2" value="1‡∏Å.‡∏û‡∏¥‡πÄ‡∏®‡∏©">
                        <label for="form_type_2">‡∏†.‡∏á.‡∏î. 1‡∏Å.‡∏û‡∏¥‡πÄ‡∏®‡∏©</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="form_type_3" value="2">
                        <label for="form_type_3">‡∏†.‡∏á.‡∏î. 2</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="form_type_4" value="2‡∏Å">
                        <label for="form_type_4">‡∏†.‡∏á.‡∏î. 2‡∏Å</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="form_type_5" value="3">
                        <label for="form_type_5">‡∏†.‡∏á.‡∏î. 3</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="form_type_6" value="3‡∏Å">
                        <label for="form_type_6">‡∏†.‡∏á.‡∏î. 3‡∏Å</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="form_type_7" value="53">
                        <label for="form_type_7">‡∏†.‡∏á.‡∏î. 53</label>
                    </div>
                </div>
            </div>
            
            <!-- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î CSV -->
            <div class="section">
                <div class="section-title">üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
                <div class="info-box">
                    <p><strong>üìä ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö CSV:</strong> ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà, ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô, ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà, ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢, ‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å, ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢</p>
                    <p><strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> 1, ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏Å‡∏∏‡∏•, 1234567890123, 123 ‡∏ñ.‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó..., ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, 50000, 5000, 2568</p>
                </div>
                
                <label for="csv_file" class="csv-upload">
                    <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                    <div style="font-size: 18px; font-weight: 600; color: #667eea;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV</div>
                    <div style="font-size: 14px; color: #666; margin-top: 5px;">‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
                    <input type="file" id="csv_file" accept=".csv" onchange="handleCSV(event)">
                </label>
                
                <div class="preview-table" id="preview_table"></div>
            </div>
            
            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á PDF -->
            <div class="section no-print">
                <button class="btn btn-success" onclick="generateAllPDFs()">
                    üöÄ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (PDF)
                </button>
                
                <div class="progress-container" id="progress_container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress_fill">0%</div>
                    </div>
                    <p style="text-align: center; margin-top: 10px; font-weight: 600;" id="progress_text"></p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // === Configuration ===
        const STORAGE_KEY = 'company_data_50tawi';
        let csvData = [];
        let signaturePad = null;
        let isDrawing = false;
        let savedSignature = null;
        
        // === Initialize ===
        window.onload = function() {
            loadCompanyData();
            initSignaturePad();
            setDefaultDate();
        };
        
        // === Signature Pad ===
        function initSignaturePad() {
            const canvas = document.getElementById('signature_pad');
            const ctx = canvas.getContext('2d');
            
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }
        
        function startDrawing(e) {
            isDrawing = true;
            const canvas = document.getElementById('signature_pad');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }
        
        function draw(e) {
            if (!isDrawing) return;
            const canvas = document.getElementById('signature_pad');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        }
        
        function stopDrawing() {
            isDrawing = false;
        }
        
        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            e.target.dispatchEvent(mouseEvent);
        }
        
        function clearSignature() {
            const canvas = document.getElementById('signature_pad');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            savedSignature = null;
        }
        
        function saveSignature() {
            const canvas = document.getElementById('signature_pad');
            savedSignature = canvas.toDataURL();
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }
        
        // === Company Data ===
        function loadCompanyData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const data = JSON.parse(saved);
                document.getElementById('company_name').value = data.company_name || '';
                document.getElementById('company_tax_id').value = data.company_tax_id || '';
                document.getElementById('company_address').value = data.company_address || '';
                document.getElementById('signer_name').value = data.signer_name || '';
                document.getElementById('signer_position').value = data.signer_position || '';
            }
        }
        
        function saveCompanyData() {
            const data = {
                company_name: document.getElementById('company_name').value,
                company_tax_id: document.getElementById('company_tax_id').value,
                company_address: document.getElementById('company_address').value,
                signer_name: document.getElementById('signer_name').value,
                signer_position: document.getElementById('signer_position').value
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }
        
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('issue_date').value = today;
        }
        
        // === CSV Handler ===
        function handleCSV(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                parseCSV(text);
            };
            reader.readAsText(file, 'UTF-8');
        }
        
        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim());
            csvData = [];
            
            // Skip header row
            for (let i = 1; i < lines.length; i++) {
                const cols = lines[i].split(',').map(col => col.trim());
                if (cols.length >= 8) {
                    csvData.push({
                        sequence: cols[0],
                        name: cols[1],
                        tax_id: cols[2],
                        address: cols[3],
                        income_type: cols[4],
                        amount_paid: parseFloat(cols[5]) || 0,
                        tax_withheld: parseFloat(cols[6]) || 0,
                        payment_year: cols[7]
                    });
                }
            }
            
            displayPreview();
        }
        
        function displayPreview() {
            if (csvData.length === 0) return;
            
            let html = '<h3>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (' + csvData.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>';
            html += '<table><thead><tr>';
            html += '<th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</th>';
            html += '<th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th><th>‡∏†‡∏≤‡∏©‡∏µ‡∏´‡∏±‡∏Å</th><th>‡∏õ‡∏µ‡∏†‡∏≤‡∏©‡∏µ</th>';
            html += '</tr></thead><tbody>';
            
            csvData.slice(0, 10).forEach(row => {
                html += '<tr>';
                html += '<td>' + row.sequence + '</td>';
                html += '<td>' + row.name + '</td>';
                html += '<td>' + row.tax_id + '</td>';
                html += '<td>' + row.income_type + '</td>';
                html += '<td>' + row.amount_paid.toLocaleString() + '</td>';
                html += '<td>' + row.tax_withheld.toLocaleString() + '</td>';
                html += '<td>' + row.payment_year + '</td>';
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            if (csvData.length > 10) {
                html += '<p style="margin-top: 10px; color: #666;">‡πÅ‡∏™‡∏î‡∏á 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ' + csvData.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>';
            }
            
            document.getElementById('preview_table').innerHTML = html;
        }
        
        // === PDF Generation ===
        async function generateAllPDFs() {
            if (csvData.length === 0) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            // Validate
            const companyName = document.getElementById('company_name').value;
            const companyTaxId = document.getElementById('company_tax_id').value;
            const companyAddress = document.getElementById('company_address').value;
            const signerName = document.getElementById('signer_name').value;
            const signerPosition = document.getElementById('signer_position').value;
            const issueDate = document.getElementById('issue_date').value;
            
            if (!companyName || !companyTaxId || !companyAddress || !signerName || !signerPosition || !issueDate) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            // Save company data
            saveCompanyData();
            
            // Get selected form types
            const formTypes = [];
            for (let i = 1; i <= 7; i++) {
                const checkbox = document.getElementById('form_type_' + i);
                if (checkbox.checked) {
                    formTypes.push(checkbox.value);
                }
            }
            
            if (formTypes.length === 0) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó');
                return;
            }
            
            // Show progress
            document.getElementById('progress_container').style.display = 'block';
            
            const { jsPDF } = window.jspdf;
            
            for (let i = 0; i < csvData.length; i++) {
                const employee = csvData[i];
                const progress = Math.round(((i + 1) / csvData.length) * 100);
                
                document.getElementById('progress_fill').style.width = progress + '%';
                document.getElementById('progress_fill').textContent = progress + '%';
                document.getElementById('progress_text').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á: ' + employee.name + ' (' + (i + 1) + '/' + csvData.length + ')';
                
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Header
                pdf.setFontSize(10);
                pdf.text('Copy 1 (For employee to attach with tax return)', 105, 15, { align: 'center' });
                
                pdf.setFontSize(16);
                pdf.setFont(undefined, 'bold');
                pdf.text('WITHHOLDING TAX CERTIFICATE', 105, 22, { align: 'center' });
                
                pdf.setFontSize(12);
                pdf.setFont(undefined, 'normal');
                pdf.text('Section 50 Bis, Revenue Code', 105, 28, { align: 'center' });
                
                // Payer info (Left box)
                pdf.rect(15, 35, 90, 35);
                pdf.setFontSize(10);
                pdf.setFont(undefined, 'bold');
                pdf.text('Payer:', 17, 40);
                pdf.setFont(undefined, 'normal');
                pdf.text('Tax ID: ' + companyTaxId, 17, 45);
                pdf.text(companyName, 17, 50);
                
                const addressLines = pdf.splitTextToSize(companyAddress, 86);
                pdf.text(addressLines, 17, 55);
                
                // Payee info (Right box)
                pdf.rect(110, 35, 90, 35);
                pdf.setFont(undefined, 'bold');
                pdf.text('Payee:', 112, 40);
                pdf.setFont(undefined, 'normal');
                pdf.text('Tax ID: ' + employee.tax_id, 112, 45);
                pdf.text(employee.name, 112, 50);
                
                const empAddressLines = pdf.splitTextToSize(employee.address, 86);
                pdf.text(empAddressLines, 112, 55);
                
                // Form type checkboxes
                pdf.rect(15, 75, 185, 15);
                pdf.text('Form Type:', 17, 80);
                const types = ['1‡∏Å', '1‡∏Å.‡∏û‡∏¥‡πÄ‡∏®‡∏©', '2', '2‡∏Å', '3', '3‡∏Å', '53'];
                let xPos = 45;
                types.forEach(type => {
                    if (formTypes.includes(type)) {
                        pdf.rect(xPos, 76, 4, 4, 'F');
                    } else {
                        pdf.rect(xPos, 76, 4, 4);
                    }
                    pdf.setFontSize(9);
                    pdf.text(type, xPos + 6, 79.5);
                    xPos += 20;
                });
                
                // Income table
                pdf.setFontSize(10);
                const tableY = 95;
                
                pdf.autoTable({
                    startY: tableY,
                    head: [['Income Type', 'Year', 'Amount Paid', 'Tax Withheld']],
                    body: [[
                        employee.income_type,
                        employee.payment_year,
                        employee.amount_paid.toLocaleString('th-TH', { minimumFractionDigits: 2 }),
                        employee.tax_withheld.toLocaleString('th-TH', { minimumFractionDigits: 2 })
                    ]],
                    theme: 'grid',
                    styles: { font: 'helvetica', fontSize: 10, cellPadding: 3 },
                    headStyles: { fillColor: [240, 240, 240], textColor: [0, 0, 0], fontStyle: 'bold' },
                    margin: { left: 15, right: 15 }
                });
                
                // Total
                const finalY = pdf.lastAutoTable.finalY + 10;
                pdf.setFont(undefined, 'bold');
                pdf.text('Total Tax Withheld: ' + employee.tax_withheld.toLocaleString('th-TH', { minimumFractionDigits: 2 }) + ' THB', 15, finalY);
                
                // Signature section
                const sigY = finalY + 15;
                pdf.setFont(undefined, 'normal');
                pdf.text('Authorized Signature:', 15, sigY);
                
                if (savedSignature) {
                    pdf.addImage(savedSignature, 'PNG', 15, sigY + 2, 40, 15);
                }
                
                pdf.text('(' + signerName + ')', 15, sigY + 20);
                pdf.text('Position: ' + signerPosition, 15, sigY + 25);
                pdf.text('Date: ' + formatThaiDate(issueDate), 15, sigY + 30);
                
                // Company stamp area
                pdf.rect(140, sigY, 50, 35);
                pdf.text('Company Stamp', 165, sigY + 18, { align: 'center' });
                
                // Save PDF
                pdf.save('Tax_Certificate_' + employee.sequence + '_' + employee.name.replace(/\s+/g, '_') + '.pdf');
                
                // Delay between PDFs
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            document.getElementById('progress_text').textContent = '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ' + csvData.length + ' ‡πÑ‡∏ü‡∏•‡πå!';
            setTimeout(() => {
                document.getElementById('progress_container').style.display = 'none';
                document.getElementById('progress_fill').style.width = '0%';
            }, 3000);
        }
        
        function formatThaiDate(dateStr) {
            const date = new Date(dateStr);
            const months = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                          '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
            return date.getDate() + ' ' + months[date.getMonth()] + ' ' + (date.getFullYear() + 543);
        }
    </script>
</body>
</html>