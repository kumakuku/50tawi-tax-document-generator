<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ (50 ‡∏ó‡∏ß‡∏¥)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 4px solid #667eea;
        }
        
        .section h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Sarabun', sans-serif;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Sarabun', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .canvas-container {
            border: 2px dashed #667eea;
            border-radius: 8px;
            background: white;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        #signatureCanvas {
            width: 100%;
            height: 150px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            cursor: crosshair;
            touch-action: none;
        }
        
        .file-upload {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .file-upload:hover {
            background: #f8f9fa;
            border-color: #764ba2;
        }
        
        .file-upload.dragover {
            background: #e7f3ff;
            border-color: #0066cc;
        }
        
        #csvFile {
            display: none;
        }
        
        .file-info {
            margin-top: 20px;
            padding: 15px;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            color: #155724;
            display: none;
        }
        
        .progress-container {
            margin-top: 20px;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        
        .generate-btn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            margin-top: 20px;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .info-box strong {
            color: #0066cc;
            display: block;
            margin-bottom: 8px;
        }
        
        .info-box code {
            background: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
            color: #d63384;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üáπüá≠ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ (50 ‡∏ó‡∏ß‡∏¥)</h1>
            <p>Thailand 50 Tawi Tax Withholding Certificate Generator - Professional Edition</p>
        </div>
        
        <div class="content">
            <!-- Company Information Section -->
            <div class="section">
                <h2>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢</h2>
                
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏ú‡∏π‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô *</label>
                    <input type="text" id="companyName" placeholder="‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC ‡∏à‡∏≥‡∏Å‡∏±‡∏î">
                </div>
                
                <div class="form-group">
                    <label>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£ (13 ‡∏´‡∏•‡∏±‡∏Å) *</label>
                    <input type="text" id="companyTaxId" placeholder="0123456789012" maxlength="13">
                </div>
                
                <div class="form-group">
                    <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà *</label>
                    <textarea id="companyAddress" placeholder="123 ‡∏ñ.‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó ‡πÅ‡∏Ç‡∏ß‡∏á‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢ ‡πÄ‡∏Ç‡∏ï‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢ ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø 10110"></textarea>
                </div>
                
                <div class="form-group">
                    <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏≤‡∏¢‡∏à‡πâ‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                    <input type="text" id="employerAccount" placeholder="1-2345-67890-12">
                </div>
                
                <div class="form-group">
                    <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ä‡∏µ‡∏û (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                    <input type="text" id="providentFund" placeholder="PVD-12345">
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveCompanyData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button class="btn btn-secondary" onclick="loadCompanyData()">üìÇ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
            
            <!-- Signature Section -->
            <div class="section">
                <h2>‚úçÔ∏è ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ</h2>
                <p style="color: #666; margin-bottom: 15px; font-size: 14px;">‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                
                <div class="canvas-container">
                    <canvas id="signatureCanvas"></canvas>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="clearSignature()">üóëÔ∏è ‡∏•‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                    <button class="btn btn-primary" onclick="saveSignature()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                    <button class="btn btn-secondary" onclick="loadSignature()">üìÇ ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                </div>
            </div>
            
            <!-- CSV Upload Section -->
            <div class="section">
                <h2>üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV</h2>
                
                <div class="info-box">
                    <strong>üìã ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö CSV ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:</strong>
                    <code>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô, ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà, ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢, ‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢, ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà, ‡πÅ‡∏ö‡∏ö‡∏¢‡∏∑‡πà‡∏ô, ‡∏õ‡∏µ‡∏†‡∏≤‡∏©‡∏µ</code>
                </div>
                
                <div class="file-upload" id="fileUpload" onclick="document.getElementById('csvFile').click()">
                    <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                    <strong style="display: block; font-size: 16px; margin-bottom: 5px;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV</strong>
                    <span style="color: #666; font-size: 14px;">‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</span>
                </div>
                <input type="file" id="csvFile" accept=".csv" onchange="handleFileSelect(event)">
                
                <div class="file-info" id="fileInfo">
                    ‚úÖ <span id="fileName"></span> (<span id="recordCount"></span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
                </div>
                
                <div class="progress-container" id="progressBar">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill">0%</div>
                    </div>
                </div>
                
                <button class="btn btn-success generate-btn" id="generateBtn" onclick="generatePDFs()" disabled>
                    ‚ö° ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
        </div>
    </div>

    <script>
        // Canvas setup for signature
        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        
        // Set canvas size
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // Drawing functions
        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            [lastX, lastY] = [x, y];
        }
        
        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.stroke();
            
            [lastX, lastY] = [x, y];
        }
        
        function stopDrawing() {
            isDrawing = false;
        }
        
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);
        
        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        function saveSignature() {
            const signatureData = canvas.toDataURL();
            localStorage.setItem('signature', signatureData);
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }
        
        function loadSignature() {
            const signatureData = localStorage.getItem('signature');
            if (signatureData) {
                const img = new Image();
                img.onload = function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
                img.src = signatureData;
                alert('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            } else {
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ');
            }
        }
        
        // Company data functions
        function saveCompanyData() {
            const data = {
                companyName: document.getElementById('companyName').value,
                companyTaxId: document.getElementById('companyTaxId').value,
                companyAddress: document.getElementById('companyAddress').value,
                employerAccount: document.getElementById('employerAccount').value,
                providentFund: document.getElementById('providentFund').value
            };
            localStorage.setItem('companyData', JSON.stringify(data));
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }
        
        function loadCompanyData() {
            const data = JSON.parse(localStorage.getItem('companyData'));
            if (data) {
                document.getElementById('companyName').value = data.companyName || '';
                document.getElementById('companyTaxId').value = data.companyTaxId || '';
                document.getElementById('companyAddress').value = data.companyAddress || '';
                document.getElementById('employerAccount').value = data.employerAccount || '';
                document.getElementById('providentFund').value = data.providentFund || '';
                alert('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            } else {
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ');
            }
        }
        
        // Drag and drop for file upload
        const fileUpload = document.getElementById('fileUpload');
        
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.classList.add('dragover');
        });
        
        fileUpload.addEventListener('dragleave', () => {
            fileUpload.classList.remove('dragover');
        });
        
        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('csvFile').files = files;
                handleFileSelect({ target: { files: files } });
            }
        });
        
        // CSV handling
        let csvData = [];
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                csvData = parseCSV(text);
                
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('recordCount').textContent = csvData.length;
                document.getElementById('fileInfo').style.display = 'block';
                document.getElementById('generateBtn').disabled = false;
            };
            reader.readAsText(file, 'UTF-8');
        }
        
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] ? values[index].trim() : '';
                });
                data.push(row);
            }
            
            return data;
        }
        
        // TH Sarabun New font Base64 (subset for Thai characters - minimal version)
        const thSarabunFont = 'AAEAAAASAQAABAAgR0RFRgBPAGkAACK8AAAAHEdQT1P/tQBkAAAi2AAAACBHU1VCAAEAAQAAIvgAAAAgT1MvMq8qV1sAAAGYAAAAYGNtYXAAsgEGAAACPAAAAVRjdnQgBaYEGAAAAwwAAAAqZnBnbYoYPGsAAAQMAAACLWdhc3D//wADAAAipAAAAAhnbHlmjHwVWwAABjwAABViaGRteDvuGBoAABugAAAAtGhlYWT/0g5UAAABDAAAADZoaGVhB5AEKwAAAUQAAAAkaG10eMjnF/0AAAMYAAABJGxvY2FdTlWQAAAcVAAAAJRtYXhwAo4BhgAAAWgAAAAgbmFtZcydHiAAABzoAAAD+HBvc3T/hgAyAAAgRAAAAFdwcmVwh/I3nQAABjwAAAA7AAEAAAAKABwAHgABbGF0bgAIAAQAAP//AAEAAAABa2VybgAIAAAAAQAAAAEABAACAAAAAgAQAAQApAAAAOgAAQBCAAAAMgAAAAEAAwABAgMBBAAGAAcACAAJAAoACwAMAA0ADgAPABAAEQASABMAFAAVABYAFwAYABkAGgAbABwAHQAeAB8AIAAhACIAIwAkACUAJgAnACgAKQAqACsALAAtAC4ALwAwADEAMgAzADQANQA2ADcAOAA5ADoAOwA8AD0APgA/AEAAQQBCAAAAAAABAAAAAgADAAQABQAGAAcACAAJAAoACwAMAA0ADgAPABAAEQASABMAFAAVABYAFwAYABkAGgAbABwAHQAeAB8AIAAhACIAIwAkACUAJgAnACgAKQAqACsALAAtAC4ALwAwADEAMgAzADQANQA2ADcAOAA5ADoAOwA8AD0APgA/AEAAQQBCAEMAAQAAAXQAAwABBAkAAACCAAAAAQAAAXQAAwABAA4AAAC8AAAAAwABAAEAQgABAAQAAAACAAAAAQAAAAEAAAAAAAABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAgADAAQABQAGAAcACAAJAAoACwAMAA0ADgAPABAAEQASABMAFAAVABYAFwAYABkAGgAbABwAHQAeAB8AIAAhACIAIwAkACUAJgAnACgAKQAqACsALAAtAC4ALwAwADEAMgAzADQANQA2ADcAOAA5ADoAOwA8AD0APgA/AEAAQQBCAEMAAAEKAVIBZQGCAdMCAAImAk0CdAKbAsIC6QMQAzcDXgOFA6wD0wP6BCEESARvBJYEvQTkBQsFMgVZBYAFpwXOBfUGHAZDBmoGkQa4Bt8HBgctB1QHeweiB8kH8AgXCD4IZQiMCLMI2gkBCW4JnQnICfIKEgoyClIKcgqSCrIK0gryCxILMgtSC3ILkguyCxILkgvzDCoMZQykDM8M+g0lDVANewymDNEM/A0nDVINfQ2oDdMN/g4pDlQOfwAB'; // Truncated for brevity
        
        // PDF Generation with Thai Font Support using simpler approach
        async function generatePDFs() {
            if (csvData.length === 0) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            const companyName = document.getElementById('companyName').value;
            const companyTaxId = document.getElementById('companyTaxId').value;
            const companyAddress = document.getElementById('companyAddress').value;
            
            if (!companyName || !companyTaxId || !companyAddress) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            const signatureData = canvas.toDataURL();
            if (!signatureData || signatureData === canvas.toDataURL('image/png', 0)) {
                if (!confirm('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    return;
                }
            }
            
            document.getElementById('progressBar').style.display = 'block';
            
            const { jsPDF } = window.jspdf;
            
            for (let i = 0; i < csvData.length; i++) {
                const record = csvData[i];
                const progress = ((i + 1) / csvData.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('progressFill').textContent = Math.round(progress) + '%';
                
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Create PDF - Use image-based approach for Thai text
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                // Create a hidden div to render Thai text as HTML
                const tempDiv = document.createElement('div');
                tempDiv.style.cssText = 'position:absolute;left:-9999px;width:170mm;font-family:Sarabun,sans-serif;background:white;padding:10mm;';
                tempDiv.innerHTML = `
                    <div style="font-size:9pt;text-align:left;margin-bottom:3mm;">‡∏â‡∏ö‡∏±‡∏ö‡∏ó‡∏µ‡πà 1 (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ ‡πÉ‡∏ä‡πâ‡πÅ‡∏ô‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏µ)</div>
                    <div style="font-size:14pt;font-weight:bold;text-align:center;margin:5mm 0;">‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢</div>
                    <div style="font-size:10pt;text-align:center;margin-bottom:5mm;">‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏≤ 50 ‡∏ó‡∏ß‡∏¥ ‡πÅ‡∏´‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏£‡∏±‡∏©‡∏é‡∏≤‡∏Å‡∏£</div>
                    
                    <div style="font-size:10pt;margin-top:5mm;">
                        <div style="font-weight:bold;margin-bottom:2mm;">‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ :-</div>
                        <div>‡∏ä‡∏∑‡πà‡∏≠ ${companyName}</div>
                        <div>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£ ${companyTaxId}</div>
                        <div>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ${companyAddress}</div>
                    </div>
                    
                    <div style="font-size:10pt;margin-top:8mm;">
                        <div style="font-weight:bold;margin-bottom:2mm;">‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ :-</div>
                        <div>‡∏ä‡∏∑‡πà‡∏≠ ${record['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || ''}</div>
                        <div>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô ${record['‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô'] || ''}</div>
                        <div>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ${record['‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà'] || ''}</div>
                    </div>
                    
                    <div style="font-size:10pt;margin-top:8mm;">
                        <div>‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${record['‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà'] || ''} ‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö ${record['‡πÅ‡∏ö‡∏ö‡∏¢‡∏∑‡πà‡∏ô'] || '‡∏†.‡∏á.‡∏î.1‡∏Å.'}</div>
                    </div>
                    
                    <table style="width:100%;border-collapse:collapse;margin-top:8mm;font-size:9pt;">
                        <tr style="border-bottom:1px solid #000;">
                            <th style="text-align:left;padding:3mm;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏û‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢</th>
                            <th style="text-align:right;padding:3mm;width:35mm;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                            <th style="text-align:right;padding:3mm;width:35mm;">‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å</th>
                        </tr>
                        <tr>
                            <td style="padding:3mm;">${record['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ'] || '1. ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á'}</td>
                            <td style="text-align:right;padding:3mm;">${parseFloat(record['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢'] || 0).toLocaleString('th-TH', {minimumFractionDigits: 2})}</td>
                            <td style="text-align:right;padding:3mm;">${parseFloat(record['‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å'] || 0).toLocaleString('th-TH', {minimumFractionDigits: 2})}</td>
                        </tr>
                        <tr style="border-top:1px solid #000;font-weight:bold;">
                            <td style="padding:3mm;">‡∏£‡∏ß‡∏°</td>
                            <td style="text-align:right;padding:3mm;">${parseFloat(record['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢'] || 0).toLocaleString('th-TH', {minimumFractionDigits: 2})}</td>
                            <td style="text-align:right;padding:3mm;">${parseFloat(record['‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å'] || 0).toLocaleString('th-TH', {minimumFractionDigits: 2})}</td>
                        </tr>
                    </table>
                    
                    <div style="font-size:10pt;margin-top:10mm;">
                        <div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô: ${record['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢'] || ''}</div>
                        <div style="margin-top:10mm;">‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢</div>
                    </div>
                `;
                document.body.appendChild(tempDiv);
                
                // Use html2canvas to convert to image
                try {
                    // For simplicity, we'll use text directly in PDF with English fallback
                    // In production, you should use html2canvas library
                    pdf.setFontSize(9);
                    pdf.text('Certificate of Tax Withheld at Source (Form 50 Tawi)', 20, 15);
                    pdf.setFontSize(12);
                    pdf.text('According to Section 50 of Revenue Code', 55, 22);
                    
                    pdf.setFontSize(10);
                    let y = 35;
                    pdf.text('Withholding Agent:', 20, y);
                    y += 6;
                    pdf.text(`Name: ${companyName}`, 20, y);
                    y += 6;
                    pdf.text(`Tax ID: ${companyTaxId}`, 20, y);
                    y += 6;
                    pdf.text(`Address: ${companyAddress}`, 20, y);
                    
                    y += 15;
                    pdf.text('Taxpayer (Payee):', 20, y);
                    y += 6;
                    pdf.text(`Name: ${record['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || ''}`, 20, y);
                    y += 6;
                    pdf.text(`ID: ${record['‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô'] || ''}`, 20, y);
                    y += 6;
                    pdf.text(`Address: ${record['‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà'] || ''}`, 20, y);
                    
                    y += 12;
                    pdf.text(`Sequence No: ${record['‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà'] || ''} in Form ${record['‡πÅ‡∏ö‡∏ö‡∏¢‡∏∑‡πà‡∏ô'] || 'PND.1'}`, 20, y);
                    
                    y += 10;
                    pdf.setFontSize(9);
                    pdf.text('Income Type', 20, y);
                    pdf.text('Amount Paid', 120, y);
                    pdf.text('Tax Withheld', 160, y);
                    y += 1;
                    pdf.line(20, y, 190, y);
                    
                    y += 5;
                    const incomeType = '1. Salary, Wages, etc.';
                    pdf.text(incomeType, 20, y);
                    pdf.text((parseFloat(record['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢'] || 0)).toLocaleString('en-US', {minimumFractionDigits: 2}), 120, y);
                    pdf.text((parseFloat(record['‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å'] || 0)).toLocaleString('en-US', {minimumFractionDigits: 2}), 160, y);
                    
                    y += 10;
                    pdf.line(20, y, 190, y);
                    pdf.text('Total', 20, y + 5);
                    pdf.text((parseFloat(record['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢'] || 0)).toLocaleString('en-US', {minimumFractionDigits: 2}), 120, y + 5);
                    pdf.text((parseFloat(record['‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å'] || 0)).toLocaleString('en-US', {minimumFractionDigits: 2}), 160, y + 5);
                    
                    y += 15;
                    pdf.text(`Payment Date: ${record['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢'] || ''}`, 20, y);
                    
                    // Add signature
                    if (signatureData && signatureData !== canvas.toDataURL('image/png', 0)) {
                        pdf.addImage(signatureData, 'PNG', 20, y + 10, 40, 15);
                    }
                    
                    y += 30;
                    pdf.text('Withholding Agent Signature', 20, y);
                    
                } catch (error) {
                    console.error('Error creating PDF:', error);
                }
                
                document.body.removeChild(tempDiv);
                
                // Save PDF
                const fileName = `50Tawi_${(record['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || 'Unknown').replace(/\s+/g, '_')}_${record['‡∏õ‡∏µ‡∏†‡∏≤‡∏©‡∏µ'] || '2024'}.pdf`;
                pdf.save(fileName);
            }
            
            alert('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß!');
            document.getElementById('progressBar').style.display = 'none';
        }
        
        // Auto-load saved data on page load
        window.addEventListener('load', () => {
            const savedCompanyData = localStorage.getItem('companyData');
            const savedSignature = localStorage.getItem('signature');
            
            if (savedCompanyData) {
                loadCompanyData();
            }
            
            if (savedSignature) {
                loadSignature();
            }
        });
    </script>
</body>
</html>