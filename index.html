<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üáπüá≠ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ (50 ‡∏ó‡∏ß‡∏¥)</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/4.1.7/signature_pad.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 1.05em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Sarabun', sans-serif;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .upload-area:hover {
            background: #f0f4ff;
            border-color: #764ba2;
        }

        .upload-area.dragover {
            background: #e8f0ff;
            border-color: #667eea;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-family: 'Sarabun', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(17, 153, 142, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .data-preview {
            background: white;
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow: auto;
            margin-top: 20px;
        }

        .data-preview table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-preview th,
        .data-preview td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-preview th {
            background: #667eea;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .data-preview tr:hover {
            background: #f8f9fa;
        }

        .signature-pad-container {
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            background: white;
            margin-top: 10px;
        }

        .signature-pad {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: crosshair;
            display: block;
            background: white;
        }

        .signature-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .signature-preview {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .signature-preview img {
            max-width: 300px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }

        .progress-container {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .progress-log {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9em;
        }

        .progress-log div {
            padding: 5px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .progress-log div:last-child {
            border-bottom: none;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .feature-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .section {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .signature-buttons {
                flex-direction: column;
            }
        }

        /* PDF Preview Styles */
        .pdf-preview {
            background: white;
            padding: 40px;
            max-width: 800px;
            margin: 20px auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .pdf-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }

        .pdf-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .pdf-subtitle {
            font-size: 1.2em;
            color: #666;
        }

        .pdf-section {
            margin-bottom: 25px;
        }

        .pdf-label {
            font-weight: bold;
            color: #333;
            display: inline-block;
            min-width: 200px;
        }

        .pdf-value {
            color: #000;
        }

        .pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .pdf-table th,
        .pdf-table td {
            border: 1px solid #333;
            padding: 10px;
            text-align: left;
        }

        .pdf-table th {
            background: #f0f0f0;
            font-weight: bold;
        }

        .pdf-signature {
            margin-top: 40px;
            text-align: right;
        }

        .pdf-signature img {
            max-width: 200px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üáπüá≠ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢</h1>
            <p>Thailand 50 Tawi Tax Withholding Certificate Generator Pro</p>
        </div>

        <div class="content">
            <!-- Features Overview -->
            <div class="section">
                <h2>‚ú® ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡πà‡∏ô</h2>
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üìÑ</div>
                        <h3>‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏à‡∏£‡∏¥‡∏á</h3>
                        <p>‡πÑ‡∏ü‡∏•‡πå PDF ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üè¢</div>
                        <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</h3>
                        <p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">‚úçÔ∏è</div>
                        <h3>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</h3>
                        <p>‡πÄ‡∏ã‡πá‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">‚ö°</div>
                        <h3>‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∏‡∏î</h3>
                        <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô</p>
                    </div>
                </div>
            </div>

            <!-- Step 1: Company Information -->
            <div class="section">
                <h2>üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó)</h2>
                <div class="alert alert-info">
                    <strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="companyName">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó / ‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ *</label>
                        <input type="text" id="companyName" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC ‡∏à‡∏≥‡∏Å‡∏±‡∏î" required>
                    </div>
                    <div class="form-group">
                        <label for="companyTaxId">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ (13 ‡∏´‡∏•‡∏±‡∏Å) *</label>
                        <input type="text" id="companyTaxId" placeholder="0123456789012" maxlength="13" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="companyAddress">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà *</label>
                    <textarea id="companyAddress" rows="3" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏ñ‡∏ô‡∏ô ‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå" required></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="companyPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <input type="tel" id="companyPhone" placeholder="02-123-4567">
                    </div>
                    <div class="form-group">
                        <label for="companyEmail">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <input type="email" id="companyEmail" placeholder="contact@company.com">
                    </div>
                </div>

                <button class="btn btn-secondary" onclick="saveCompanyInfo()">
                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
                </button>
            </div>

            <!-- Step 2: Digital Signature -->
            <div class="section">
                <h2>‚úçÔ∏è ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</h2>
                <div class="alert alert-info">
                    <strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                </div>

                <div class="signature-pad-container">
                    <label><strong>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà:</strong></label>
                    <canvas id="signaturePad" class="signature-pad" width="600" height="200"></canvas>
                    
                    <div class="signature-buttons">
                        <button class="btn btn-secondary" onclick="clearSignature()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                        <button class="btn btn-primary" onclick="saveSignature()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                    </div>

                    <div id="signaturePreview" class="signature-preview hidden">
                        <p><strong>‚úÖ ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ:</strong></p>
                        <img id="signatureImage" alt="Saved Signature">
                    </div>
                </div>
            </div>

            <!-- Step 3: Income Type Selection -->
            <div class="section">
                <h2>üí∞ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ</h2>
                <div class="form-group">
                    <label for="incomeType">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ *</label>
                    <select id="incomeType">
                        <option value="‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (Salary)</option>
                        <option value="‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á">‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á (Wage)</option>
                        <option value="‡πÇ‡∏ö‡∏ô‡∏±‡∏™">‡πÇ‡∏ö‡∏ô‡∏±‡∏™ (Bonus)</option>
                        <option value="‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤">‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (Overtime)</option>
                        <option value="‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô (Commission)</option>
                        <option value="‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á">‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á (Allowance)</option>
                        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Other)</option>
                    </select>
                </div>
            </div>

            <!-- Step 4: CSV Upload -->
            <div class="section">
                <h2>üìä ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (CSV)</h2>
                <div class="alert alert-info">
                    <strong>üìå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå CSV ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:</strong><br>
                    <code>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô, ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà, ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ, ‡∏†‡∏≤‡∏©‡∏µ‡∏´‡∏±‡∏Å, ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡∏õ‡∏µ</code><br>
                    <small>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ, 1234567890123, 123 ‡∏ñ.‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó ‡∏Å‡∏ó‡∏°. 10110, 50000, 2500, ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°, 2567</small>
                </div>

                <div class="upload-area" id="uploadArea" onclick="document.getElementById('csvFile').click()">
                    <div class="upload-icon">üìÅ</div>
                    <h3>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</h3>
                    <p>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .csv ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
                    <input type="file" id="csvFile" accept=".csv" style="display: none;" onchange="handleFileSelect(event)">
                </div>

                <div id="dataPreview" class="data-preview hidden"></div>
            </div>

            <!-- Step 5: Generate PDFs -->
            <div class="section">
                <h2>üöÄ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ PDF</h2>
                <button class="btn btn-success btn-large" id="generateBtn" onclick="generateAllPDFs()" disabled>
                    üìÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>

                <div id="progressContainer" class="progress-container">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%">0%</div>
                    </div>
                    <div id="progressLog" class="progress-log"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let employeeData = [];
        let signaturePad;
        let savedSignature = null;

        // Initialize signature pad
        window.onload = function() {
            const canvas = document.getElementById('signaturePad');
            signaturePad = new SignaturePad(canvas, {
                backgroundColor: 'rgb(255, 255, 255)',
                penColor: 'rgb(0, 0, 0)'
            });

            // Load saved company info
            loadCompanyInfo();
            
            // Load saved signature
            loadSignature();

            // Setup drag and drop
            setupDragAndDrop();
        };

        // Drag and drop functionality
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => {
                    uploadArea.classList.add('dragover');
                }, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => {
                    uploadArea.classList.remove('dragover');
                }, false);
            });

            uploadArea.addEventListener('drop', function(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            }, false);
        }

        // Company info functions
        function saveCompanyInfo() {
            const companyInfo = {
                name: document.getElementById('companyName').value,
                taxId: document.getElementById('companyTaxId').value,
                address: document.getElementById('companyAddress').value,
                phone: document.getElementById('companyPhone').value,
                email: document.getElementById('companyEmail').value
            };

            localStorage.setItem('companyInfo', JSON.stringify(companyInfo));
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        function loadCompanyInfo() {
            const saved = localStorage.getItem('companyInfo');
            if (saved) {
                const companyInfo = JSON.parse(saved);
                document.getElementById('companyName').value = companyInfo.name || '';
                document.getElementById('companyTaxId').value = companyInfo.taxId || '';
                document.getElementById('companyAddress').value = companyInfo.address || '';
                document.getElementById('companyPhone').value = companyInfo.phone || '';
                document.getElementById('companyEmail').value = companyInfo.email || '';
            }
        }

        // Signature functions
        function clearSignature() {
            signaturePad.clear();
        }

        function saveSignature() {
            if (signaturePad.isEmpty()) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            savedSignature = signaturePad.toDataURL();
            localStorage.setItem('signature', savedSignature);

            // Show preview
            document.getElementById('signaturePreview').classList.remove('hidden');
            document.getElementById('signatureImage').src = savedSignature;

            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        function loadSignature() {
            const saved = localStorage.getItem('signature');
            if (saved) {
                savedSignature = saved;
                document.getElementById('signaturePreview').classList.remove('hidden');
                document.getElementById('signatureImage').src = savedSignature;
            }
        }

        // File handling
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            if (!file.name.endsWith('.csv')) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                parseCSV(text);
            };
            reader.readAsText(file, 'UTF-8');
        }

        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim());
            
            if (lines.length < 2) {
                alert('‚ö†Ô∏è ‡πÑ‡∏ü‡∏•‡πå CSV ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                return;
            }

            // Skip header and parse data
            employeeData = [];
            for (let i = 1; i < lines.length; i++) {
                const parts = lines[i].split(',').map(s => s.trim());
                if (parts.length >= 7) {
                    employeeData.push({
                        name: parts[0],
                        taxId: parts[1],
                        address: parts[2],
                        income: parseFloat(parts[3]) || 0,
                        taxWithheld: parseFloat(parts[4]) || 0,
                        month: parts[5],
                        year: parts[6]
                    });
                }
            }

            if (employeeData.length === 0) {
                alert('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV');
                return;
            }

            displayDataPreview();
            document.getElementById('generateBtn').disabled = false;
        }

        function displayDataPreview() {
            const preview = document.getElementById('dataPreview');
            preview.classList.remove('hidden');

            let html = `
                <h3>üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ (${employeeData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                            <th>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</th>
                            <th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th>
                            <th>‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ</th>
                            <th>‡∏†‡∏≤‡∏©‡∏µ‡∏´‡∏±‡∏Å</th>
                            <th>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            employeeData.forEach(emp => {
                html += `
                    <tr>
                        <td>${emp.name}</td>
                        <td>${emp.taxId}</td>
                        <td>${emp.address}</td>
                        <td>${emp.income.toLocaleString('th-TH', {minimumFractionDigits: 2})} ‡∏ö‡∏≤‡∏ó</td>
                        <td>${emp.taxWithheld.toLocaleString('th-TH', {minimumFractionDigits: 2})} ‡∏ö‡∏≤‡∏ó</td>
                        <td>${emp.month} ${emp.year}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            preview.innerHTML = html;
        }

        // PDF Generation
        async function generateAllPDFs() {
            // Validate company info
            const companyName = document.getElementById('companyName').value;
            const companyTaxId = document.getElementById('companyTaxId').value;
            const companyAddress = document.getElementById('companyAddress').value;

            if (!companyName || !companyTaxId || !companyAddress) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            if (!savedSignature) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            if (employeeData.length === 0) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            // Show progress
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressLog = document.getElementById('progressLog');
            
            progressContainer.style.display = 'block';
            progressLog.innerHTML = '';
            
            const incomeType = document.getElementById('incomeType').value;
            const { jsPDF } = window.jspdf;

            // Generate PDFs
            for (let i = 0; i < employeeData.length; i++) {
                const employee = employeeData[i];
                const progress = Math.round(((i + 1) / employeeData.length) * 100);
                
                progressFill.style.width = progress + '%';
                progressFill.textContent = progress + '%';
                
                const logEntry = document.createElement('div');
                logEntry.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á: ${employee.name}...`;
                progressLog.appendChild(logEntry);
                progressLog.scrollTop = progressLog.scrollHeight;

                try {
                    await generatePDF(employee, companyName, companyTaxId, companyAddress, incomeType);
                    logEntry.textContent = `‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à: ${employee.name}`;
                } catch (error) {
                    logEntry.textContent = `‚ùå ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${employee.name} - ${error.message}`;
                }

                // Small delay to prevent browser freeze
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            const finalLog = document.createElement('div');
            finalLog.innerHTML = '<strong>üéâ ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!</strong>';
            finalLog.style.color = '#28a745';
            finalLog.style.fontWeight = 'bold';
            progressLog.appendChild(finalLog);
        }

        async function generatePDF(employee, companyName, companyTaxId, companyAddress, incomeType) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');

            // Set Thai font (using default for now, can be enhanced with custom Thai font)
            doc.setFont('helvetica');
            
            let y = 20;

            // Header
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢', 105, y, { align: 'center' });
            y += 8;
            doc.setFontSize(14);
            doc.text('(50 ‡∏ó‡∏ß‡∏¥)', 105, y, { align: 'center' });
            y += 10;

            // Company Info Section
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô:', 20, y);
            y += 7;
            
            doc.setFont('helvetica', 'normal');
            doc.text(`‡∏ä‡∏∑‡πà‡∏≠: ${companyName}`, 20, y);
            y += 6;
            doc.text(`‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: ${companyTaxId}`, 20, y);
            y += 6;
            doc.text(`‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${companyAddress}`, 20, y);
            y += 10;

            // Employee Info Section
            doc.setFont('helvetica', 'bold');
            doc.text('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô:', 20, y);
            y += 7;
            
            doc.setFont('helvetica', 'normal');
            doc.text(`‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•: ${employee.name}`, 20, y);
            y += 6;
            doc.text(`‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô: ${employee.taxId}`, 20, y);
            y += 6;
            doc.text(`‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${employee.address}`, 20, y);
            y += 10;

            // Income Details Section
            doc.setFont('helvetica', 'bold');
            doc.text('‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏©‡∏µ:', 20, y);
            y += 7;
            
            doc.setFont('helvetica', 'normal');
            doc.text(`‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ: ${incomeType}`, 20, y);
            y += 6;
            doc.text(`‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ: ${employee.income.toLocaleString('th-TH', {minimumFractionDigits: 2})} ‡∏ö‡∏≤‡∏ó`, 20, y);
            y += 6;
            doc.text(`‡∏†‡∏≤‡∏©‡∏µ‡∏´‡∏±‡∏Å‡πÑ‡∏ß‡πâ: ${employee.taxWithheld.toLocaleString('th-TH', {minimumFractionDigits: 2})} ‡∏ö‡∏≤‡∏ó`, 20, y);
            y += 6;
            doc.text(`‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ: ${employee.month} ${employee.year}`, 20, y);
            y += 15;

            // Signature
            if (savedSignature) {
                doc.text('‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô:', 20, y);
                y += 10;
                doc.addImage(savedSignature, 'PNG', 20, y, 50, 15);
                y += 20;
            }

            // Footer
            doc.setFontSize(10);
            doc.text(`‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: ${new Date().toLocaleDateString('th-TH')}`, 20, y);

            // Save PDF
            const filename = `50Tawi_${employee.name.replace(/\s+/g, '_')}_${employee.month}_${employee.year}.pdf`;
            doc.save(filename);
        }
    </script>
</body>
</html>